<!DOCTYPE html>
<html>
<head>
    <title>Iron & Asphalt - Multi-Jump</title>
    <style>
        body { margin: 0; background: #87CEEB; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: white; }
        canvas { display: block; }
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0, 0, 0, 0.6); z-index: 10;
        }
        h1 { font-size: 70px; margin: 0; color: #eee; text-shadow: 2px 2px 0 #444; letter-spacing: 5px; font-weight: 800; }
        .menu-btn {
            background: linear-gradient(#444, #111); border: 1px solid #666; color: #fff;
            padding: 15px 40px; font-size: 20px; cursor: pointer; margin: 10px;
            transition: 0.2s; width: 250px; border-radius: 4px;
        }
        .menu-btn:hover { background: #555; border-color: #fff; transform: translateY(-2px); }
        
        #dashboard {
            position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
            width: 320px; height: 160px; background: linear-gradient(0deg, #1a1a1a 0%, #333 100%);
            border: 4px solid #555; border-bottom: none; border-radius: 160px 160px 0 0;
            display: none; z-index: 5; box-shadow: 0 -5px 25px rgba(0,0,0,0.5); text-align: center;
        }
        #speedometer { margin-top: 40px; font-size: 48px; font-weight: 900; color: #0ff; text-shadow: 0 0 10px #0ff; }
        .dash-label { font-size: 12px; color: #aaa; letter-spacing: 2px; }
        #nitro-bar-container { width: 120px; height: 10px; background: #111; margin: 10px auto; border: 1px solid #444; border-radius: 5px; overflow: hidden; }
        #nitro-bar { width: 100%; height: 100%; background: #ff3366; transition: 0.3s; }
        #top-stats { position: absolute; top: 20px; left: 20px; font-size: 18px; color: #333; font-weight: bold; background: rgba(255,255,255,0.7); padding: 10px; border-radius: 5px; display: none; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="top-stats">
        <b>DST:</b> <span id="score">0</span>m | <b>LIVES:</b> <span id="lives" style="color:#ff3366">❤❤❤</span>
    </div>

    <div id="dashboard">
        <div id="speedometer">0</div>
        <div class="dash-label">KM/H</div>
        <div id="nitro-bar-container"><div id="nitro-bar"></div></div>
        <div class="dash-label">MULTI-JUMP READY</div>
    </div>

    <div id="main-menu" class="overlay">
        <h1>IRON & ASPHALT</h1>
        <button class="menu-btn" onclick="startGame()">Enter Race</button>
        <button class="menu-btn" onclick="toggleSettings()">Options</button>
    </div>

    <div id="settings-menu" class="overlay hidden">
        <h1>OPTIONS</h1>
        <label>Engine Power: 
            <select id="difficulty" style="padding: 10px; background: #222; color: #fff;">
                <option value="5">V4 Engine (Easy)</option>
                <option value="8" selected>V8 Engine (Normal)</option>
                <option value="12">Twin Turbo (Hard)</option>
            </select>
        </label>
        <button class="menu-btn" onclick="toggleSettings()">Return</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let gameState = 'MENU';

let score, gameSpeed, charges, lives, player, hazards, rockets, clouds, jumpPuffs = [], wheelAngle = 0, groundOffset = 0;
const gravity = 0.8; 
const groundY = window.innerHeight - 120;

function initClouds() {
    clouds = [];
    for(let i = 0; i < 6; i++) {
        clouds.push({ x: Math.random() * window.innerWidth, y: 50 + Math.random() * 150, size: 40 + Math.random() * 60, speed: 0.1 + Math.random() * 0.3 });
    }
}

function initGame() {
    score = 0; lives = 3; charges = 3;
    gameSpeed = parseInt(document.getElementById('difficulty').value);
    hazards = []; rockets = []; jumpPuffs = [];
    // player.jump is now the strength of each individual jump
    player = { x: 150, y: groundY - 50, w: 70, h: 50, velY: 0, jumpStrength: 12, grounded: true, isDashing: 0, invincibility: 0 };
    initClouds();
    updateUI();
}

function updateUI() {
    document.getElementById('score').innerText = Math.floor(score/10);
    document.getElementById('speedometer').innerText = Math.floor(gameSpeed * 15 + (player.isDashing ? 50 : 0));
    document.getElementById('nitro-bar').style.width = (charges / 3 * 100) + "%";
    document.getElementById('lives').innerText = "❤".repeat(Math.max(0, lives));
}

function spawnHazard() {
    const lastX = hazards.length > 0 ? hazards[hazards.length - 1].x : window.innerWidth;
    hazards.push({ x: lastX + 700 + Math.random() * 500, y: groundY - 40, w: 40, h: 40 });
}

function spawnRocket() {
    if (gameState !== 'PLAYING') return;
    rockets.push({ x: window.innerWidth + 200, y: player.y, w: 60, h: 20, speed: gameSpeed + 6 });
    setTimeout(spawnRocket, 3500 + Math.random() * 2500);
}

function startGame() {
    document.getElementById('main-menu').classList.add('hidden');
    document.getElementById('top-stats').style.display = 'block';
    document.getElementById('dashboard').style.display = 'block';
    initGame();
    gameState = 'PLAYING';
    spawnRocket();
    for(let i=0; i<3; i++) spawnHazard();
}

function toggleSettings() {
    const menu = document.getElementById('main-menu');
    const settings = document.getElementById('settings-menu');
    if (gameState === 'MENU') { menu.classList.add('hidden'); settings.classList.remove('hidden'); gameState = 'SETTINGS'; }
    else { settings.classList.add('hidden'); menu.classList.remove('hidden'); gameState = 'MENU'; }
}

window.onkeydown = (e) => {
    if (gameState !== 'PLAYING') return;
    
    // MULTI-JUMP LOGIC: Space can be pressed even if not grounded
    if (e.code === 'Space') { 
        player.velY = -player.jumpStrength; 
        
        // Add a visual "puff" effect if jumping in mid-air
        if (!player.grounded) {
            jumpPuffs.push({ x: player.x + 35, y: player.y + 40, r: 5, life: 20 });
        }
        
        player.grounded = false; 
    }
    
    if (e.code === 'ShiftLeft' && charges > 0 && !player.isDashing) {
        player.isDashing = 30; charges--;
        updateUI();
    }
};

function drawCyclist(x, y) {
    if (player.invincibility % 10 > 5) return;
    ctx.save();
    ctx.translate(x, y);

    const drawWheel = (wx, wy) => {
        ctx.fillStyle = '#111';
        ctx.beginPath(); ctx.arc(wx, wy, 15, 0, Math.PI * 2); ctx.fill();
        ctx.strokeStyle = '#333'; ctx.lineWidth = 3; ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle = '#666'; ctx.lineWidth = 1;
        ctx.moveTo(wx, wy);
        ctx.lineTo(wx + Math.cos(wheelAngle) * 15, wy + Math.sin(wheelAngle) * 15);
        ctx.stroke();
    };
    drawWheel(15, 35); drawWheel(55, 35);

    ctx.strokeStyle = '#333'; ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(15, 35); ctx.lineTo(35, 15); ctx.lineTo(55, 35);
    ctx.moveTo(35, 15); ctx.lineTo(25, 5);
    ctx.stroke();

    ctx.fillStyle = '#444';
    ctx.beginPath(); ctx.arc(35, -5, 8, 0, Math.PI * 2); ctx.fill(); 
    ctx.fillStyle = '#0af'; 
    ctx.fillRect(38, -8, 5, 4);
    
    ctx.strokeStyle = '#222'; ctx.lineWidth = 6;
    ctx.beginPath(); ctx.moveTo(35, 3); ctx.lineTo(35, 20); ctx.stroke(); 
    
    ctx.restore();
    wheelAngle += gameSpeed * 0.1;
}

function update() {
    if (gameState === 'PLAYING') {
        if (player.isDashing > 0) { groundOffset -= 15; player.isDashing--; }
        if (player.invincibility > 0) player.invincibility--;

        player.velY += gravity;
        player.y += player.velY;
        if (player.y + player.h > groundY) { 
            player.y = groundY - player.h; 
            player.velY = 0; 
            player.grounded = true; 
        }

        groundOffset -= gameSpeed;
        if (groundOffset <= -200) groundOffset = 0;
        clouds.forEach(c => { c.x -= c.speed; if (c.x < -100) c.x = window.innerWidth + 100; });
        hazards.forEach(h => h.x -= gameSpeed);
        rockets.forEach(r => r.x -= r.speed);
        
        // Update air puffs
        jumpPuffs.forEach(p => { p.life--; p.y += 1; p.r += 0.5; });
        jumpPuffs = jumpPuffs.filter(p => p.life > 0);

        score++;
        if (score % 10 === 0) updateUI();
        gameSpeed += 0.0002;

        if (hazards.length < 5) spawnHazard();
        if (hazards[0]?.x < -100) hazards.shift();

        // Collision
        hazards.forEach(h => {
            if (player.x < h.x + h.w && player.x + player.w > h.x && player.y < h.y + h.h && player.y + player.h > h.y) {
                if(player.invincibility <= 0) { lives--; player.invincibility = 60; updateUI(); }
            }
        });
        
        rockets.forEach(r => {
            if (player.x < r.x + r.w && player.x + player.w > r.x && player.y < r.y + r.h && player.y + player.h > r.y) {
                if(player.invincibility <= 0) { lives--; player.invincibility = 60; updateUI(); }
            }
        });

        if (lives <= 0) gameOver();
    }
    draw();
    requestAnimationFrame(update);
}

function gameOver() {
    gameState = 'MENU';
    document.getElementById('main-menu').classList.remove('hidden');
    document.getElementById('top-stats').style.display = 'none';
    document.getElementById('dashboard').style.display = 'none';
    alert("TOTAL DISTANCE: " + Math.floor(score/10) + "m");
}

function draw() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    let skyGrd = ctx.createLinearGradient(0, 0, 0, groundY);
    skyGrd.addColorStop(0, '#4facfe');
    skyGrd.addColorStop(1, '#00f2fe');
    ctx.fillStyle = skyGrd;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "#FFF500";
    ctx.shadowBlur = 50; ctx.shadowColor = "yellow";
    ctx.beginPath(); ctx.arc(window.innerWidth - 100, 100, 50, 0, Math.PI * 2); ctx.fill();
    ctx.shadowBlur = 0;

    ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
    clouds.forEach(c => {
        ctx.beginPath(); ctx.arc(c.x, c.y, c.size/2, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(c.x + 30, c.y + 10, c.size/2.5, 0, Math.PI*2); ctx.fill();
    });

    ctx.fillStyle = '#444';
    ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);
    
    ctx.fillStyle = "#FFF";
    for (let i = 0; i < canvas.width + 200; i += 100) {
        ctx.fillRect(i + groundOffset, groundY + 45, 40, 5);
    }

    if(gameState === 'PLAYING') {
        // Draw air puffs
        jumpPuffs.forEach(p => {
            ctx.fillStyle = `rgba(255, 255, 255, ${p.life / 20})`;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
        });

        hazards.forEach(h => {
            ctx.fillStyle = "#ff6600";
            ctx.beginPath(); ctx.moveTo(h.x, h.y+h.h); ctx.lineTo(h.x+h.w/2, h.y); ctx.lineTo(h.x+h.w, h.y+h.h); ctx.fill();
            ctx.fillStyle = "#fff"; ctx.fillRect(h.x+h.w/4, h.y+h.h/2, h.w/2, 5);
        });

        rockets.forEach(r => {
            ctx.fillStyle = '#666';
            ctx.fillRect(r.x, r.y, r.w, r.h);
            ctx.fillStyle = "#f90"; ctx.fillRect(r.x + r.w, r.y + 5, 10, r.h - 10);
        });

        drawCyclist(player.x, player.y);
    }
}

initClouds();
update();
</script>
</body>
</html>